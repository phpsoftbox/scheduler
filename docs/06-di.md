# DI и конфигурация

## Файл расписания

Файл(ы) расписания должен(ы) возвращать callable:

```php
use PhpSoftBox\Scheduler\Scheduler;

return static function (Scheduler $scheduler): void {
    $scheduler->run(SomeTask::class, 'daily-report')->dailyAt('02:30');
};
```

`ScheduleLoader` поддерживает путь к файлу или каталогу с `*.php`.
Если доступен `CacheInterface`, блокировки задач включены по умолчанию.

## Пример с PHP-DI

```php
use PhpSoftBox\Scheduler\ScheduleLoader;
use PhpSoftBox\Scheduler\Scheduler;
use Psr\Container\ContainerInterface;
use Psr\SimpleCache\CacheInterface;

return [
    ScheduleLoader::class => static function (ContainerInterface $container): ScheduleLoader {
        $path = $container->get(\PhpSoftBox\Config\Path\PathInterface::class)
            ->createPath('config/schedule');

        return new ScheduleLoader($path);
    },

    Scheduler::class => static function (ContainerInterface $container): Scheduler {
        $cache = $container->has(CacheInterface::class)
            ? $container->get(CacheInterface::class)
            : null;

        $queue = null;
        if (interface_exists('PhpSoftBox\\Queue\\QueueInterface') && $container->has('PhpSoftBox\\Queue\\QueueInterface')) {
            $queue = $container->get('PhpSoftBox\\Queue\\QueueInterface');
        }

        $scheduler = new Scheduler(
            container: $container,
            cache: $cache,
            queue: $queue,
        );

        if (class_exists(\PhpSoftBox\CliApp\CliApp::class) && $container->has(\PhpSoftBox\CliApp\CliApp::class)) {
            $cli = $container->get(\PhpSoftBox\CliApp\CliApp::class);
            $scheduler->setCommandRunner(static fn (string $command, array $argv) => $cli->runCommand($command, $argv));
        }

        return $scheduler;
    },
];
```

## Обработчик задач из очереди

Если задачи отправляются в очередь через `onQueue()`, используйте обработчик:

```php
use PhpSoftBox\Scheduler\Queue\SchedulerQueueJobHandler;
```

Он принимает payload от планировщика и запускает обработчики задач.
